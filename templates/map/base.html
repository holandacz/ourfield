{% extends "site_base.html" %}
{% load staticfiles %}

{% load i18n %}
{% load ifsetting_tag %}
{% load map_tags %}

{% block head_title %}{% trans "Map" %}{% endblock %}

{% block extra_style %}
  <link href="{% static "css/map.css" %}" rel="stylesheet" />
  <link href="{% static "css/list.css" %}" rel="stylesheet" />
{% endblock %}

{% block extra_script %}
  <script>
    API = "{% url api_dispatch_list api_name="v1" resource_name="place" %}";
    {% if data %}
      app = {loaded: true};
    {% endif %}
  </script>
{% endblock %}

{% block body %}
  <div id="app">
    <div id="map">
      <div class="container">

        <h1 class="page-header small" id="page-header" style="display:none"></h1>
        <h2 class="small" id="page-menu" style="display:none">Page Menu</h2>
        
        <div class="map-container">
          <div id="place-types" style="display:none">Places:&nbsp;
            <label for="place-types-1">1</label>&nbsp;<input id="place-types-1" name="place-types" type="checkbox" value="1" checked="checked" />&nbsp;&nbsp;|&nbsp;&nbsp;<label for="place-types-2">2</label>&nbsp;<input id="place-types-2" name="place-types" type="checkbox" value="2" />
          </div>
          <div id="map-canvas">{% include "map/crosshair.html" %}</div>
          <div id="map-crosshair"><img src="{% static "img/map/crosshair.png" %}" /></div>

        </div>
      </div><!-- container -->
    </div>
    <span style="page-break-before: always;"> List View </span>
    <div id="log"></div>
    <div id="list"></div>
    <div id="search"></div>
  </div>
{% endblock %}


{% block extra_body %}
  <script type="text/javascript" src="{% static "bootstrap/js/bootstrap-modal.js" %}"></script>
  <script type="text/javascript" src="{% static "js/underscore.js" %}"></script>
  <script type="text/javascript" src="{% static "js/json2.js" %}"></script>
  <script type="text/javascript" src="{% static "js/backbone.js" %}"></script>
  <script type="text/javascript" src="{% static "js/backbone-tastypie.js" %}"></script>
  <script type="text/javascript" src="{% static "js/jquery.cookie.js" %}"></script>
  <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?sensor=false"></script>

  {% include "map/edit-info-window-template.html" %}
  {% include "map/info-window-template.html" %}

  <script type="text/javascript" src="{% static "js/app.js" %}"></script>

  <script type="text/javascript">
      var territoryno = "{{ territoryno|default_if_none:"0" }}";
      var zoom = 16; //{{zoom}}
      var center = "10.001025,-84.134588"; //"{{center}}"

      var preferences = new Preferences();
      if (territoryno) {
        preferences.set('territoryno', territoryno);
      }

      preferences.setDefault('zoom', zoom);
      preferences.setDefault('center', center);
      preferences.setDefault('territoryno', territoryno);

      var appData = new AppData({
        userid: {{ user.id|default_if_none:0 }},
        username: "{{ user.username|default_if_none:"" }}",
        zoom: 16,
        center: "10.001025,-84.134588"
      });

      DefaultParams.userid = {{ user.id|default_if_none:0 }}
      DefaultParams.username = "{{ user.username|default_if_none:"" }}"
      DefaultParams.usergroups = "{{ user.usergroups }}"
      DefaultParams.userisstaff = {{ userisstaff }}
      DefaultParams.userissuperuser = {{ userissuperuser }}
      DefaultParams.api_key = "{{ api_key }}"
      DefaultParams.territoryno = "{{ territoryno|default_if_none:"" }}"

      var placeTypes = new PlaceTypes();
      placeTypes.add({id: 1, name: "school"});
      placeTypes.add({id: 2, name: "business"});

      $(function() {
        new AppView({
          el: '#app',
          model: appData,
          collection: placeTypes,
          preferences: preferences
        });
      });

      // placeTypes.get(1).show();
      // placeTypes.get(2).show();

      //places.fetch();

      x = 0;

  </script>
{% endblock %}
